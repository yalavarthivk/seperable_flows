train_mnf.py --batch-size 64 --epochs 1000 -lr 0.001 --dataset mimiciv --n-gaussians 3 --encoder transformer --flayers 0 --n-heads 1 --n-hidden 128 -ct 36 -ft 0 --fold 0
2025-11-16 06:23:49,475 - INFO - Arguments: Namespace(epochs=1000, batch_size=64, val_batch_size=50, learn_rate=0.001, betas=[0.9, 0.999], weight_decay=0.001, seed=42, flayers=0, n_gaussians=3, n_heads=1, encoder='transformer', enc_layers=1, n_hiddens=128, dataset='mimiciv', forc_time=0, cond_time=36, nfolds=5, fold=0, bounds=20, num_bins=16, output_dir='saved_models', patience=30, scheduler_patience=10)
2025-11-16 06:23:49,476 - INFO - Starting training with experiment ID: 629476
2025-11-16 06:23:49,476 - INFO - Using device: cuda
2025-11-16 06:23:49,507 - INFO - Available Models: {'GRU-ODE-Bayes', 'TFT', 'mTAN', 'NODE', 'IP-Net', 'N-BEATS', 'SET-TS', 'Latent-ODE', 'Informer', 'BRITS', 'M-RNN', 'NCDE', 'TPA', 'ODE-RNN'}
2025-11-16 06:23:49,507 - INFO - Available Datasets: {'tourism2', 'USHCN', 'Human Activity', 'Air Quality Multi-Site', 'Character Trajectories', 'Physionet 2019', 'Household Consumption', 'M5', 'Electricity', 'tourism1', 'M3', 'M4', 'MuJoCo', 'Air Quality', 'Traffic', 'UWAVE', 'Physionet 2012'}
2025-11-16 06:23:49,643 - INFO - Note: detected 80 virtual cores but NumExpr set to maximum of 64, check "NUMEXPR_MAX_THREADS" environment variable.
2025-11-16 06:23:49,643 - INFO - Note: NumExpr detected 80 cores but "NUMEXPR_MAX_THREADS" not set, so enforcing safe limit of 8.
2025-11-16 06:23:49,643 - INFO - NumExpr defaulting to 8 threads.
2025-11-16 06:23:51,252 - WARNING - usetex mode requires TeX.
2025-11-16 06:23:51,355 - INFO - File 'timeseries.parquet' validated successfully 'filehash='7045f656e7fed321fd8175ac1904ca6e4880e4d1cae52d182f2b5dab79dadf4a''.
2025-11-16 06:23:52,121 - INFO - File 'timeseries.parquet' validated successfully 'filehash='7045f656e7fed321fd8175ac1904ca6e4880e4d1cae52d182f2b5dab79dadf4a''.
2025-11-16 06:24:08,301 - INFO - Model initialized with 290818 parameters
================================================================================
Layer (type:depth-idx)                                  Param #
================================================================================
Moses                                                   --
├─ModuleList: 1-1                                       --
├─MultiGaussian: 1-2                                    --
│    └─Linear: 2-1                                      129
│    └─Linear: 2-2                                      16,512
├─MixtureWeights: 1-3                                   384
│    └─Linear: 2-3                                      129
│    └─Dropout: 2-4                                     --
├─TimeSeriesEncoder: 1-4                                --
│    └─Linear: 2-5                                      2
│    └─Linear: 2-6                                      254
│    └─Linear: 2-7                                      2
│    └─Linear: 2-8                                      254
│    └─Linear: 2-9                                      13,184
│    └─Linear: 2-10                                     13,184
│    └─Linear: 2-11                                     32,896
│    └─Linear: 2-12                                     33,024
│    └─ModuleList: 2-13                                 --
│    │    └─MultiHeadAttention: 3-1                     65,664
│    └─MultiHeadAttention: 2-14                         --
│    │    └─Linear: 3-2                                 16,384
│    │    └─Linear: 3-3                                 16,384
│    │    └─Linear: 3-4                                 16,384
│    │    └─Linear: 3-5                                 16,512
│    │    └─ScaledDotProductAttention: 3-6              --
│    └─Linear: 2-15                                     49,536
│    └─ReLU: 2-16                                       --
================================================================================
Total params: 290,818
Trainable params: 290,818
Non-trainable params: 0
================================================================================
2025-11-16 06:24:08,304 - INFO - Model summary:
================================================================================
Layer (type:depth-idx)                                  Param #
================================================================================
Moses                                                   --
├─ModuleList: 1-1                                       --
├─MultiGaussian: 1-2                                    --
│    └─Linear: 2-1                                      129
│    └─Linear: 2-2                                      16,512
├─MixtureWeights: 1-3                                   384
│    └─Linear: 2-3                                      129
│    └─Dropout: 2-4                                     --
├─TimeSeriesEncoder: 1-4                                --
│    └─Linear: 2-5                                      2
│    └─Linear: 2-6                                      254
│    └─Linear: 2-7                                      2
│    └─Linear: 2-8                                      254
│    └─Linear: 2-9                                      13,184
│    └─Linear: 2-10                                     13,184
│    └─Linear: 2-11                                     32,896
│    └─Linear: 2-12                                     33,024
│    └─ModuleList: 2-13                                 --
│    │    └─MultiHeadAttention: 3-1                     65,664
│    └─MultiHeadAttention: 2-14                         --
│    │    └─Linear: 3-2                                 16,384
│    │    └─Linear: 3-3                                 16,384
│    │    └─Linear: 3-4                                 16,384
│    │    └─Linear: 3-5                                 16,512
│    │    └─ScaledDotProductAttention: 3-6              --
│    └─Linear: 2-15                                     49,536
│    └─ReLU: 2-16                                       --
================================================================================
Total params: 290,818
Trainable params: 290,818
Non-trainable params: 0
================================================================================
2025-11-16 06:24:09,834 - INFO - Starting training loop...
2025-11-16 06:24:19,778 - INFO - Epoch   1/1000 | Train njNLL: 1.235832 | Train mNLL: 1.257391| Val njNLL: 1.195503 | Val mNLL: 1.235652| Time: 9.94s
2025-11-16 06:24:19,830 - INFO - New best model saved with val_loss: 1.195503
2025-11-16 06:24:29,336 - INFO - Epoch   2/1000 | Train njNLL: 1.192774 | Train mNLL: 1.238212| Val njNLL: 1.175891 | Val mNLL: 1.223743| Time: 9.50s
2025-11-16 06:24:29,382 - INFO - New best model saved with val_loss: 1.175891
2025-11-16 06:24:38,922 - INFO - Epoch   3/1000 | Train njNLL: 1.182611 | Train mNLL: 1.231805| Val njNLL: 1.173630 | Val mNLL: 1.223140| Time: 9.54s
2025-11-16 06:24:38,968 - INFO - New best model saved with val_loss: 1.173630
2025-11-16 06:24:48,450 - INFO - Epoch   4/1000 | Train njNLL: 1.171701 | Train mNLL: 1.219299| Val njNLL: 1.153439 | Val mNLL: 1.194932| Time: 9.48s
2025-11-16 06:24:48,495 - INFO - New best model saved with val_loss: 1.153439
2025-11-16 06:24:57,986 - INFO - Epoch   5/1000 | Train njNLL: 1.156358 | Train mNLL: 1.196756| Val njNLL: 1.138772 | Val mNLL: 1.182625| Time: 9.49s
2025-11-16 06:24:58,032 - INFO - New best model saved with val_loss: 1.138772
2025-11-16 06:25:07,594 - INFO - Epoch   6/1000 | Train njNLL: 1.139020 | Train mNLL: 1.181547| Val njNLL: 1.122958 | Val mNLL: 1.161771| Time: 9.56s
2025-11-16 06:25:07,639 - INFO - New best model saved with val_loss: 1.122958
2025-11-16 06:25:17,106 - INFO - Epoch   7/1000 | Train njNLL: 1.124218 | Train mNLL: 1.159062| Val njNLL: 1.111666 | Val mNLL: 1.141479| Time: 9.47s
2025-11-16 06:25:17,152 - INFO - New best model saved with val_loss: 1.111666
2025-11-16 06:25:26,574 - INFO - Epoch   8/1000 | Train njNLL: 1.107696 | Train mNLL: 1.133297| Val njNLL: 1.093565 | Val mNLL: 1.112513| Time: 9.42s
2025-11-16 06:25:26,619 - INFO - New best model saved with val_loss: 1.093565
2025-11-16 06:25:36,242 - INFO - Epoch   9/1000 | Train njNLL: 1.097545 | Train mNLL: 1.112448| Val njNLL: 1.089463 | Val mNLL: 1.102444| Time: 9.62s
2025-11-16 06:25:36,287 - INFO - New best model saved with val_loss: 1.089463
2025-11-16 06:25:45,906 - INFO - Epoch  10/1000 | Train njNLL: 1.087489 | Train mNLL: 1.097701| Val njNLL: 1.079273 | Val mNLL: 1.093748| Time: 9.62s
2025-11-16 06:25:45,976 - INFO - New best model saved with val_loss: 1.079273
2025-11-16 06:25:55,485 - INFO - Epoch  11/1000 | Train njNLL: 1.081304 | Train mNLL: 1.092104| Val njNLL: 1.078006 | Val mNLL: 1.086489| Time: 9.51s
2025-11-16 06:25:55,531 - INFO - New best model saved with val_loss: 1.078006
2025-11-16 06:26:04,984 - INFO - Epoch  12/1000 | Train njNLL: 1.075585 | Train mNLL: 1.083406| Val njNLL: 1.077279 | Val mNLL: 1.091367| Time: 9.45s
2025-11-16 06:26:05,030 - INFO - New best model saved with val_loss: 1.077279
2025-11-16 06:26:14,578 - INFO - Epoch  13/1000 | Train njNLL: 1.069529 | Train mNLL: 1.077903| Val njNLL: 1.071529 | Val mNLL: 1.080051| Time: 9.55s
2025-11-16 06:26:14,624 - INFO - New best model saved with val_loss: 1.071529
2025-11-16 06:26:24,203 - INFO - Epoch  14/1000 | Train njNLL: 1.065428 | Train mNLL: 1.071890| Val njNLL: 1.069898 | Val mNLL: 1.081615| Time: 9.58s
2025-11-16 06:26:24,248 - INFO - New best model saved with val_loss: 1.069898
2025-11-16 06:26:33,880 - INFO - Epoch  15/1000 | Train njNLL: 1.062524 | Train mNLL: 1.071197| Val njNLL: 1.067982 | Val mNLL: 1.076455| Time: 9.63s
2025-11-16 06:26:33,926 - INFO - New best model saved with val_loss: 1.067982
2025-11-16 06:26:43,573 - INFO - Epoch  16/1000 | Train njNLL: 1.062655 | Train mNLL: 1.070085| Val njNLL: 1.070097 | Val mNLL: 1.080918| Time: 9.65s
2025-11-16 06:26:53,221 - INFO - Epoch  17/1000 | Train njNLL: 1.058940 | Train mNLL: 1.066236| Val njNLL: 1.062349 | Val mNLL: 1.072872| Time: 9.65s
2025-11-16 06:26:53,267 - INFO - New best model saved with val_loss: 1.062349
2025-11-16 06:27:02,893 - INFO - Epoch  18/1000 | Train njNLL: 1.068875 | Train mNLL: 1.077552| Val njNLL: 1.075088 | Val mNLL: 1.087726| Time: 9.63s
2025-11-16 06:27:12,405 - INFO - Epoch  19/1000 | Train njNLL: 1.059733 | Train mNLL: 1.067534| Val njNLL: 1.071160 | Val mNLL: 1.075555| Time: 9.51s
2025-11-16 06:27:21,991 - INFO - Epoch  20/1000 | Train njNLL: 1.061010 | Train mNLL: 1.069426| Val njNLL: 1.062228 | Val mNLL: 1.067019| Time: 9.59s
2025-11-16 06:27:22,038 - INFO - New best model saved with val_loss: 1.062228
2025-11-16 06:27:31,452 - INFO - Epoch  21/1000 | Train njNLL: 1.055268 | Train mNLL: 1.061968| Val njNLL: 1.060015 | Val mNLL: 1.067721| Time: 9.41s
2025-11-16 06:27:31,498 - INFO - New best model saved with val_loss: 1.060015
2025-11-16 06:27:40,974 - INFO - Epoch  22/1000 | Train njNLL: 1.053692 | Train mNLL: 1.061239| Val njNLL: 1.060012 | Val mNLL: 1.067386| Time: 9.48s
2025-11-16 06:27:41,021 - INFO - New best model saved with val_loss: 1.060012
2025-11-16 06:27:50,647 - INFO - Epoch  23/1000 | Train njNLL: 1.052751 | Train mNLL: 1.061726| Val njNLL: 1.058579 | Val mNLL: 1.065286| Time: 9.63s
2025-11-16 06:27:50,693 - INFO - New best model saved with val_loss: 1.058579
2025-11-16 06:28:00,202 - INFO - Epoch  24/1000 | Train njNLL: 1.050398 | Train mNLL: 1.058589| Val njNLL: 1.060897 | Val mNLL: 1.067344| Time: 9.51s
2025-11-16 06:28:09,845 - INFO - Epoch  25/1000 | Train njNLL: 1.050657 | Train mNLL: 1.058612| Val njNLL: 1.056703 | Val mNLL: 1.065542| Time: 9.64s
2025-11-16 06:28:09,890 - INFO - New best model saved with val_loss: 1.056703
2025-11-16 06:28:19,552 - INFO - Epoch  26/1000 | Train njNLL: 1.048012 | Train mNLL: 1.055730| Val njNLL: 1.053970 | Val mNLL: 1.059569| Time: 9.66s
2025-11-16 06:28:19,597 - INFO - New best model saved with val_loss: 1.053970
2025-11-16 06:28:29,068 - INFO - Epoch  27/1000 | Train njNLL: 1.049769 | Train mNLL: 1.056661| Val njNLL: 1.058568 | Val mNLL: 1.065661| Time: 9.47s
2025-11-16 06:28:38,502 - INFO - Epoch  28/1000 | Train njNLL: 1.047893 | Train mNLL: 1.055510| Val njNLL: 1.057319 | Val mNLL: 1.064038| Time: 9.43s
2025-11-16 06:28:48,145 - INFO - Epoch  29/1000 | Train njNLL: 1.047680 | Train mNLL: 1.055297| Val njNLL: 1.057987 | Val mNLL: 1.064536| Time: 9.64s
2025-11-16 06:28:57,761 - INFO - Epoch  30/1000 | Train njNLL: 1.047856 | Train mNLL: 1.055133| Val njNLL: 1.061955 | Val mNLL: 1.066474| Time: 9.62s
2025-11-16 06:29:07,343 - INFO - Epoch  31/1000 | Train njNLL: 1.048762 | Train mNLL: 1.055783| Val njNLL: 1.057635 | Val mNLL: 1.061758| Time: 9.58s
2025-11-16 06:29:16,915 - INFO - Epoch  32/1000 | Train njNLL: 1.047196 | Train mNLL: 1.054065| Val njNLL: 1.057249 | Val mNLL: 1.061993| Time: 9.57s
2025-11-16 06:29:26,543 - INFO - Epoch  33/1000 | Train njNLL: 1.045961 | Train mNLL: 1.052574| Val njNLL: 1.058765 | Val mNLL: 1.068095| Time: 9.63s
2025-11-16 06:29:35,964 - INFO - Epoch  34/1000 | Train njNLL: 1.044913 | Train mNLL: 1.052998| Val njNLL: 1.055268 | Val mNLL: 1.061556| Time: 9.42s
2025-11-16 06:29:45,470 - INFO - Epoch  35/1000 | Train njNLL: 1.045728 | Train mNLL: 1.054799| Val njNLL: 1.061178 | Val mNLL: 1.065475| Time: 9.51s
2025-11-16 06:29:55,064 - INFO - Epoch  36/1000 | Train njNLL: 1.045828 | Train mNLL: 1.052625| Val njNLL: 1.055089 | Val mNLL: 1.060611| Time: 9.59s
2025-11-16 06:30:04,654 - INFO - Epoch  37/1000 | Train njNLL: 1.043746 | Train mNLL: 1.051707| Val njNLL: 1.054056 | Val mNLL: 1.059729| Time: 9.59s
2025-11-16 06:30:14,210 - INFO - Epoch  38/1000 | Train njNLL: 1.038114 | Train mNLL: 1.045879| Val njNLL: 1.054569 | Val mNLL: 1.059773| Time: 9.56s
2025-11-16 06:30:23,610 - INFO - Epoch  39/1000 | Train njNLL: 1.036017 | Train mNLL: 1.044079| Val njNLL: 1.052600 | Val mNLL: 1.056922| Time: 9.40s
2025-11-16 06:30:23,656 - INFO - New best model saved with val_loss: 1.052600
2025-11-16 06:30:33,301 - INFO - Epoch  40/1000 | Train njNLL: 1.035767 | Train mNLL: 1.043937| Val njNLL: 1.055623 | Val mNLL: 1.059334| Time: 9.64s
2025-11-16 06:30:42,812 - INFO - Epoch  41/1000 | Train njNLL: 1.034145 | Train mNLL: 1.043414| Val njNLL: 1.055030 | Val mNLL: 1.058360| Time: 9.51s
2025-11-16 06:30:52,451 - INFO - Epoch  42/1000 | Train njNLL: 1.037706 | Train mNLL: 1.047177| Val njNLL: 1.053600 | Val mNLL: 1.058584| Time: 9.64s
2025-11-16 06:31:01,923 - INFO - Epoch  43/1000 | Train njNLL: 1.034367 | Train mNLL: 1.043762| Val njNLL: 1.052672 | Val mNLL: 1.056950| Time: 9.47s
2025-11-16 06:31:11,543 - INFO - Epoch  44/1000 | Train njNLL: 1.032872 | Train mNLL: 1.041883| Val njNLL: 1.054273 | Val mNLL: 1.059084| Time: 9.62s
2025-11-16 06:31:21,005 - INFO - Epoch  45/1000 | Train njNLL: 1.032122 | Train mNLL: 1.041865| Val njNLL: 1.053618 | Val mNLL: 1.059142| Time: 9.46s
2025-11-16 06:31:30,633 - INFO - Epoch  46/1000 | Train njNLL: 1.031766 | Train mNLL: 1.041996| Val njNLL: 1.053319 | Val mNLL: 1.058462| Time: 9.63s
2025-11-16 06:31:40,235 - INFO - Epoch  47/1000 | Train njNLL: 1.031016 | Train mNLL: 1.041319| Val njNLL: 1.057287 | Val mNLL: 1.060297| Time: 9.60s
2025-11-16 06:31:49,845 - INFO - Epoch  48/1000 | Train njNLL: 1.030671 | Train mNLL: 1.040718| Val njNLL: 1.054960 | Val mNLL: 1.058942| Time: 9.61s
2025-11-16 06:31:59,545 - INFO - Epoch  49/1000 | Train njNLL: 1.032625 | Train mNLL: 1.042917| Val njNLL: 1.056570 | Val mNLL: 1.058492| Time: 9.70s
2025-11-16 06:32:09,114 - INFO - Epoch  50/1000 | Train njNLL: 1.030095 | Train mNLL: 1.040549| Val njNLL: 1.054237 | Val mNLL: 1.056839| Time: 9.57s
2025-11-16 06:32:18,644 - INFO - Epoch  51/1000 | Train njNLL: 1.025949 | Train mNLL: 1.037664| Val njNLL: 1.055112 | Val mNLL: 1.057698| Time: 9.53s
2025-11-16 06:32:28,162 - INFO - Epoch  52/1000 | Train njNLL: 1.024410 | Train mNLL: 1.036379| Val njNLL: 1.056794 | Val mNLL: 1.057826| Time: 9.52s
2025-11-16 06:32:37,686 - INFO - Epoch  53/1000 | Train njNLL: 1.023540 | Train mNLL: 1.035693| Val njNLL: 1.058064 | Val mNLL: 1.059633| Time: 9.52s
2025-11-16 06:32:47,261 - INFO - Epoch  54/1000 | Train njNLL: 1.023021 | Train mNLL: 1.036039| Val njNLL: 1.059299 | Val mNLL: 1.059486| Time: 9.57s
2025-11-16 06:32:56,877 - INFO - Epoch  55/1000 | Train njNLL: 1.022747 | Train mNLL: 1.036014| Val njNLL: 1.056211 | Val mNLL: 1.058198| Time: 9.62s
2025-11-16 06:33:06,315 - INFO - Epoch  56/1000 | Train njNLL: 1.021827 | Train mNLL: 1.035588| Val njNLL: 1.060308 | Val mNLL: 1.058566| Time: 9.44s
2025-11-16 06:33:15,711 - INFO - Epoch  57/1000 | Train njNLL: 1.021319 | Train mNLL: 1.034802| Val njNLL: 1.059010 | Val mNLL: 1.058617| Time: 9.40s
2025-11-16 06:33:25,219 - INFO - Epoch  58/1000 | Train njNLL: 1.020893 | Train mNLL: 1.034723| Val njNLL: 1.058610 | Val mNLL: 1.060110| Time: 9.51s
2025-11-16 06:33:34,924 - INFO - Epoch  59/1000 | Train njNLL: 1.020854 | Train mNLL: 1.034909| Val njNLL: 1.059227 | Val mNLL: 1.059565| Time: 9.71s
2025-11-16 06:33:44,451 - INFO - Epoch  60/1000 | Train njNLL: 1.020353 | Train mNLL: 1.034478| Val njNLL: 1.059322 | Val mNLL: 1.059510| Time: 9.53s
2025-11-16 06:33:54,045 - INFO - Epoch  61/1000 | Train njNLL: 1.019637 | Train mNLL: 1.033748| Val njNLL: 1.058776 | Val mNLL: 1.058468| Time: 9.59s
2025-11-16 06:34:03,491 - INFO - Epoch  62/1000 | Train njNLL: 1.017476 | Train mNLL: 1.032042| Val njNLL: 1.059890 | Val mNLL: 1.060202| Time: 9.45s
2025-11-16 06:34:13,121 - INFO - Epoch  63/1000 | Train njNLL: 1.015832 | Train mNLL: 1.031070| Val njNLL: 1.060546 | Val mNLL: 1.060314| Time: 9.63s
2025-11-16 06:34:22,785 - INFO - Epoch  64/1000 | Train njNLL: 1.015679 | Train mNLL: 1.031048| Val njNLL: 1.060595 | Val mNLL: 1.060410| Time: 9.66s
2025-11-16 06:34:32,405 - INFO - Epoch  65/1000 | Train njNLL: 1.015243 | Train mNLL: 1.031039| Val njNLL: 1.061257 | Val mNLL: 1.059340| Time: 9.62s
2025-11-16 06:34:41,871 - INFO - Epoch  66/1000 | Train njNLL: 1.015077 | Train mNLL: 1.030944| Val njNLL: 1.060603 | Val mNLL: 1.058718| Time: 9.47s
2025-11-16 06:34:51,379 - INFO - Epoch  67/1000 | Train njNLL: 1.014519 | Train mNLL: 1.030372| Val njNLL: 1.061664 | Val mNLL: 1.060281| Time: 9.51s
2025-11-16 06:35:00,772 - INFO - Epoch  68/1000 | Train njNLL: 1.014920 | Train mNLL: 1.030686| Val njNLL: 1.062865 | Val mNLL: 1.060390| Time: 9.39s
2025-11-16 06:35:10,317 - INFO - Epoch  69/1000 | Train njNLL: 1.013689 | Train mNLL: 1.029930| Val njNLL: 1.063899 | Val mNLL: 1.061514| Time: 9.54s
2025-11-16 06:35:10,317 - INFO - Early stopping after 30 epochs without improvement
2025-11-16 06:35:10,317 - INFO - Loading best model for final evaluation...
2025-11-16 06:35:11,851 - INFO - Final Results:
2025-11-16 06:35:11,851 - INFO - Best Val nJNLL: 1.052600
2025-11-16 06:35:11,851 - INFO - Test njNLL: 1.060091
2025-11-16 06:35:11,851 - INFO - Test mNLL: 1.056244
2025-11-16 06:35:11,851 - INFO - Test mse: 0.297528
2025-11-16 06:35:11,851 - INFO - Test robust mse: 0.297455
2025-11-16 06:35:11,851 - INFO - Test crps: 0.333029
2025-11-16 06:35:11,851 - INFO - Test energy score: 1.127280
2025-11-16 06:35:11,851 - INFO - Evaluation Time: 1.51s
